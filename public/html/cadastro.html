<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro ManuTech</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous" />
    <link rel="stylesheet" href="../style/login.css">
</head>

<body>

    <main>
        <div>
            <div class="row">
                <div class="fundo d-none d-md-block"><img src="../images/ilustracoes/fundo-login.png" alt=""></div>
                <div class="col-12 col-sm-12 col-md-12 col-lg-6 tudo-login">

                    <div class="content-login">
                        <div class="row div-logo-login">
                            <div class="logo-login col-8 col-sm-4 col-md-4 col-lg-7">
                                <img src="../images/icons/logo-manutech.png">
                            </div>
                        </div>

                        <form id="form-cadastro">
                            <div class="row form-step active tamanho-div" id="step1">
                                <div class="content-login">
                                    <div class="mb-3 inputs-login">
                                        <input type="text" class="form-control input-login"
                                            id="nome" placeholder="Nome" required>
                                    </div>
                                    <div class="mb-3 inputs-login col-lg-6 col-md-4 col-sm-10 col-10">
                                        <input type="email" class="form-control input-login"
                                            id="email" placeholder="Email" required>
                                    </div>
                                    <div class="mb-3 inputs-login col-lg-6 col-md-4 col-sm-10 col-10">
                                        <input type="text" class="form-control input-login"
                                            id="telefone" placeholder="Telefone" required>
                                    </div>
                                </div>

                                <div class="row resto-login">
                                    <div class="col-10 col-sm-10 col-md-6 col-lg-6 texto-login">
                                        <p>Já tem uma conta? <a href="login">Faça login</a></p>
                                    </div>
                                    <button type="button" class="btn btn-primary botao-login col-6 col-sm-6 col-md-4 col-lg-3" 
                                        onclick="nextStep()">Próximo</button>
                                </div>
                            </div>

                            

                            <div class="row form-step tamanho-div" id="step2">
                                <div class="content-login">
                                    <div class="mb-3 inputs-login">
                                        <input type="text" class="form-control input-login"
                                            id="empresa" placeholder="Empresa vinculada" required>
                                    </div>
                                    <div class="mb-3 inputs-login col-lg-6 col-md-4 col-sm-10 col-10">
                                        <input type="password" class="form-control input-login"
                                            id="cargo" placeholder="Cargo" required>
                                    </div>
                                    <div class="mb-3 inputs-login col-lg-6 col-md-4 col-sm-10 col-10">
                                        <input type="number" class="form-control input-login"
                                            id="cnpj" placeholder="CNPJ" required>
                                    </div>
                                </div>

                                <div class="row resto-login">
                                    <button type="button" class="btn btn-secondary botao-voltar-etapa col-4 col-sm-4 col-md-3 col-lg-2" 
                                        onclick="prevStep()">Voltar</button>
                                    <button type="submit" class="btn btn-primary botao-login col-6 col-sm-6 col-md-4 col-lg-3" href="home.html"> 
                                        Cadastrar
                                    </button>
                                </div>
                            </div>
                        </form>

                        <div class="fundo-login-2 d-none d-md-block">
                            <img src="../images/ilustracoes/fundo-login.png" class="">
                        </div>
                    </div>
                </div>

                <div class="d-none d-sm-none d-md-none d-lg-block col-lg-6">
                    <div class="img-login"></div>
                </div>
            </div>
        </div>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>

    <script>
        let currentStep = 1;

        function nextStep() {
            const nome = document.getElementById('nome').value;
            const email = document.getElementById('email').value;
            const telefone = document.getElementById('telefone').value;

            if (!nome || !email || !telefone) {
                alert('Por favor, preencha todos os campos.');
                return;
            }

            document.getElementById('step1').classList.remove('active');
            document.getElementById('step2').classList.add('active');

            currentStep = 2;
        }

        function prevStep() {
            document.getElementById('step2').classList.remove('active');
            document.getElementById('step1').classList.add('active');

            currentStep = 1;
        }

        const form = document.getElementById('form-cadastro');

        form.addEventListener('submit', async (event) => {
            event.preventDefault();

            const nome = document.getElementById('nome').value;
            const email = document.getElementById('email').value;
            const senha = document.getElementById('senha').value;
            const confirmarSenha = document.getElementById('confirmar-senha').value;

            if (senha !== confirmarSenha) {
                alert('As senhas não coincidem!');
                return;
            }

            if (senha.length < 8) {
                alert("A senha precisa ter pelo menos 8 caracteres");
                return;
            }

            try {
                const resposta = await fetch('/api/auth/registrar', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ nome, email, senha, telefone, usuario })
                });

                const resultado = await resposta.json();

                if (resultado.sucesso) {
                    alert('Conta criada com sucesso! Agora faça login.');
                    window.location.href = '/manutech/login';
                } else {
                    alert('Erro ao cadastrar: ' + resultado.erro);
                }

            } catch (error) {
                console.error('Erro:', error);
                alert('Erro de conexão. Verifique se o servidor está ligado.');
            }
        });
        //testar cadadastro/login 
// nome - Miguel G
// email - miguelsenai@gmail.com
// telefone - 11 53345-0155
// nome de usuário - miguel123
// senha - 1DASDWJaw1@
//models ; controllers ; routes
    </script>
</body>

</html>